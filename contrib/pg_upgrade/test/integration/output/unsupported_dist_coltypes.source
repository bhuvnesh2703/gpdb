-- given: tables with distribution column type using abstime, reltime, tinterval, money
-- when: upgrade check is performed
-- then: fails listing the tables which have these columns
CREATE TABLE unsupported_dist_col_abstime(a abstime) DISTRIBUTED BY(a);
CREATE
INSERT INTO unsupported_dist_col_abstime VALUES ('1901-12-14');
INSERT 1
CREATE TABLE unsupported_dist_col_reltime(a reltime) DISTRIBUTED BY(a);
CREATE
INSERT INTO unsupported_dist_col_reltime VALUES ('1 year');
INSERT 1
CREATE TABLE unsupported_dist_col_tinterval(a tinterval) DISTRIBUTED BY(a);
CREATE
INSERT INTO unsupported_dist_col_tinterval VALUES ('["May 10, 1947 23:59:12" "Jan 14, 1973 03:14:21"]');
INSERT 1
CREATE TABLE unsupported_dist_col_money(a money) DISTRIBUTED BY(a);
CREATE
INSERT INTO unsupported_dist_col_money VALUES ('34.23');
INSERT 1


! ./gpdb6/bin/pg_upgrade --old-gp-dbid=1 --new-gp-dbid=1 --check --old-bindir=/Users/bhuvneshchaudhary/workspace/gpdb/contrib/pg_upgrade/test/integration/gpdb5/bin --new-bindir=/Users/bhuvneshchaudhary/workspace/gpdb/contrib/pg_upgrade/test/integration/gpdb6/bin --old-datadir=/Users/bhuvneshchaudhary/workspace/gpdb/contrib/pg_upgrade/test/integration/gpdb5-data/qddir/demoDataDir-1 --new-datadir=/Users/bhuvneshchaudhary/workspace/gpdb/contrib/pg_upgrade/test/integration/gpdb6-data/qddir/demoDataDir-1 --old-port=50000;

*failure*
Consult the last few lines of "pg_upgrade_server.log" for
the probable cause of the failure.
Performing Consistency Checks on Old Live Server
------------------------------------------------
Checking for abstime, reltime, tinterval user data types    fatal

Your installation contains a user table, that uses a 'abstime',
'reltime', 'tinterval', 'money' or 'anyarray' type as a distribution key column. Using
these datatypes as distribution keys is no longer supported. You can use
ALTER TABLE ... SET DISTRIBUTED RANDOMLY to change the distribution keys,
and restart the upgrade.  A list of the problem columns is in the file:
    tables_using_abstime_reltime_tinterval.txt

Failure, exiting


! /bin/cat tables_using_abstime_reltime_tinterval.txt;
Database: upgradetest
  public.unsupported_dist_col_abstime.a
  public.unsupported_dist_col_reltime.a
  public.unsupported_dist_col_tinterval.a
  public.unsupported_dist_col_money.a


-- before upgrade, change the distribution policy to random distribution
ALTER TABLE unsupported_dist_col_abstime SET DISTRIBUTED RANDOMLY;
ALTER
ALTER TABLE unsupported_dist_col_reltime SET DISTRIBUTED RANDOMLY;
ALTER
ALTER TABLE unsupported_dist_col_tinterval SET DISTRIBUTED RANDOMLY;
ALTER
ALTER TABLE unsupported_dist_col_money SET DISTRIBUTED RANDOMLY;
ALTER
