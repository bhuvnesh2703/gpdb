set TimeZone to 'US/Pacific';
SET
select interval_interval_div(interval '365 days', interval '1 month') as "12 1/6";
      12 1/6      
------------------
 12.1666666666667
(1 row)

select interval_interval_mod(interval '365 days', interval '1 month') as "5*24";
   5*24    
-----------
 120:00:00
(1 row)

select v, w, r, s,
    interval_bound(v, w) as "normal",
    interval_bound(v, w, s) as "shifted s",
    interval_bound(v, w, s, r) as "and registered to r"
from ( values
        (10, 1, 0.5, 4),
        (10, 0.5, -100, null),
        (0.5, 10, -1, -1),
        (-100, 100, 10, 1),
        (-101, 10, null, 10),
        (5, 2, -100.5, 1),
        (null, 10, 0, 0),
        (55, null, 20, 0),
        ('NaN', 10, 10, 0),
        (45.6, 'NaN', 5.5, 2),
        (31, 10, 'NaN', 0)
    ) r(v,w,r,s)
order by v, w, r, s;
  v   |  w  |   r    | s  | normal | shifted s | and registered to r 
------+-----+--------+----+--------+-----------+---------------------
 -101 |  10 |        | 10 |   -110 |       -10 |                 -10
 -100 | 100 |     10 |  1 |   -100 |         0 |                 -90
  0.5 |  10 |     -1 | -1 |      0 |       -10 |                 -11
    5 |   2 | -100.5 |  1 |      4 |         6 |                 5.5
   10 | 0.5 |   -100 |    |   10.0 |      10.0 |                10.0
   10 |   1 |    0.5 |  4 |     10 |        14 |                13.5
   31 |  10 |    NaN |  0 |     30 |        30 |                 NaN
 45.6 | NaN |    5.5 |  2 |    NaN |       NaN |                 NaN
   55 |     |     20 |  0 |        |           |                    
  NaN |  10 |     10 |  0 |    NaN |       NaN |                 NaN
      |  10 |      0 |  0 |        |           |                    
(11 rows)

select v, w, r, s,
    interval_bound(v, w) as "normal",
    interval_bound(v, w, s) as "shifted s",
    interval_bound(v, w, s, r) as "and registered to r"
from ( values
        (timestamp '2012-01-12 10:00:10', interval '1 week', timestamp '2012-04-02 00:00:00', 4),
        (timestamp '1929-10-29 22:33:44.55', interval '1 year', timestamp '1991-01-17 02:34:56.78', null),
        (timestamp '1991-01-17 02:34:56.78', interval '1 year -1 month', timestamp '1776-07-04 12:34:56', -1),
        (timestamp '2100-03-01 11:11:11.11', interval '100 days', timestamp '1929-10-29 22:33:44.55', 1),
        (timestamp '1776-07-04 12:34:56', interval '1 month', timestamp '2012-04-01 00:00:00', 1),
        (null::timestamp, interval '1 week', timestamp '1911-09-09 15:16:17', 3),
        (timestamp '1999-10-30 13:01:01', null::interval, timestamp '1970-04-05 12:00:00', 1)
    ) r(v,w,r,s)
order by v, w, r, s;
           v            |    w     |           r            | s  |       normal        |      shifted s      |  and registered to r   
------------------------+----------+------------------------+----+---------------------+---------------------+------------------------
 1776-07-04 12:34:56    | 1 mon    | 2012-04-01 00:00:00    |  1 | 1776-07-01 00:00:00 | 1776-08-01 00:00:00 | 1776-08-01 00:00:00
 1929-10-29 22:33:44.55 | 1 year   | 1991-01-17 02:34:56.78 |    | 1929-01-01 00:00:00 | 1929-01-01 00:00:00 | 1929-01-17 02:34:56.78
 1991-01-17 02:34:56.78 | 11 mons  | 1776-07-04 12:34:56    | -1 | 1990-03-01 00:00:00 | 1989-04-01 00:00:00 | 1990-02-04 12:34:56
 1999-10-30 13:01:01    |          | 1970-04-05 12:00:00    |  1 |                     |                     | 
 2012-01-12 10:00:10    | 7 days   | 2012-04-02 00:00:00    |  4 | 2012-01-12 00:00:00 | 2012-02-09 00:00:00 | 2012-02-06 00:00:00
 2100-03-01 11:11:11.11 | 100 days | 1929-10-29 22:33:44.55 |  1 | 2100-01-19 00:00:00 | 2100-04-29 00:00:00 | 2100-05-25 22:33:44.55
                        | 7 days   | 1911-09-09 15:16:17    |  3 |                     |                     | 
(7 rows)

select v, w, r, s,
    interval_bound(v, w) as "normal",
    interval_bound(v, w, s) as "shifted s",
    interval_bound(v, w, s, r) as "and registered to r"
from ( values
        (timestamptz '2012-01-12 10:00:10', interval '1 week', timestamptz '2012-04-02 00:00:00 US/Eastern', 4),
        (timestamptz '1929-10-29 22:33:44.55', interval '1 year', timestamptz '1991-01-17 02:34:56.78', null),
        (timestamptz '1991-01-17 02:34:56.78', interval '1 year -1 month', timestamptz '1776-07-04 12:34:56 US/Eastern', -1),
        (timestamptz '2100-03-01 11:11:11.11 UTC', interval '100 days', timestamptz '1929-10-29 22:33:44.55', 1),
        (timestamptz '1776-07-04 12:34:56', interval '1 month', timestamptz '2012-04-01 00:00:00 UTC', 1),
        (null::timestamp, interval '1 week', timestamp '1911-09-09 15:16:17', 3),
        (timestamp '1999-10-30 13:01:01', null::interval, timestamp '1970-04-05 12:00:00', 1)
    ) r(v,w,r,s)
order by v, w, r, s;
              v               |    w     |              r               | s  |            normal            |          shifted s           |     and registered to r      
------------------------------+----------+------------------------------+----+------------------------------+------------------------------+------------------------------
 1776-07-04 12:34:56-07:52:58 | 1 mon    | 2012-03-31 17:00:00-07       |  1 | 1776-06-30 16:00:00-07:52:58 | 1776-07-31 16:00:00-07:52:58 | 1776-07-31 17:00:00-07:52:58
 1929-10-29 22:33:44.55-08    | 1 year   | 1991-01-17 02:34:56.78-08    |    | 1928-12-31 16:00:00-08       | 1928-12-31 16:00:00-08       | 1929-01-17 02:34:56.78-08
 1991-01-17 02:34:56.78-08    | 11 mons  | 1776-07-04 09:38:00-07:52:58 | -1 | 1990-02-28 16:00:00-08       | 1989-03-31 16:00:00-08       | 1990-02-04 09:38:00-08
 1999-10-30 13:01:01-07       |          | 1970-04-05 12:00:00-08       |  1 |                              |                              | 
 2012-01-12 10:00:10-08       | 7 days   | 2012-04-01 21:00:00-07       |  4 | 2012-01-11 16:00:00-08       | 2012-02-08 16:00:00-08       | 2012-02-05 21:00:00-08
 2100-03-01 03:11:11.11-08    | 100 days | 1929-10-29 22:33:44.55-08    |  1 | 2100-01-18 16:00:00-08       | 2100-04-28 16:00:00-07       | 2100-05-25 22:33:44.55-07
                              | 7 days   | 1911-09-09 15:16:17-08       |  3 |                              |                              | 
(7 rows)

select *
from generate_series(
	timestamptz '2013-01-01 12:00:00 UTC',
	timestamptz '2011-01-01 12:00:00 UTC',
	interval '-2 months');
    generate_series     
------------------------
 2013-01-01 04:00:00-08
 2012-11-01 04:00:00-07
 2012-09-01 04:00:00-07
 2012-07-01 04:00:00-07
 2012-05-01 04:00:00-07
 2012-03-01 04:00:00-08
 2012-01-01 04:00:00-08
 2011-11-01 04:00:00-07
 2011-09-01 04:00:00-07
 2011-07-01 04:00:00-07
 2011-05-01 04:00:00-07
 2011-03-01 04:00:00-08
 2011-01-01 04:00:00-08
(13 rows)

