-- start query 1 in stream 0 using template query62.tpl
explain
select  
   substr(w_warehouse_name,1,20)
  ,sm_type
  ,web_name
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk <= 30 ) then 1 else 0 end)  as "30 days" 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 30) and 
                 (ws_ship_date_sk - ws_sold_date_sk <= 60) then 1 else 0 end )  as "31-60 days" 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 60) and 
                 (ws_ship_date_sk - ws_sold_date_sk <= 90) then 1 else 0 end)  as "61-90 days" 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 90) and
                 (ws_ship_date_sk - ws_sold_date_sk <= 120) then 1 else 0 end)  as "91-120 days" 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk  > 120) then 1 else 0 end)  as ">120 days" 
from
   web_sales
  ,warehouse
  ,ship_mode
  ,web_site
  ,date_dim
where
    d_month_seq between 1212 and 1212 + 11
and ws_ship_date_sk   = d_date_sk
and ws_warehouse_sk   = w_warehouse_sk
and ws_ship_mode_sk   = sm_ship_mode_sk
and ws_web_site_sk    = web_site_sk
group by
   substr(w_warehouse_name,1,20)
  ,sm_type
  ,web_name
order by substr(w_warehouse_name,1,20)
        ,sm_type
       ,web_name
limit 100;
                                                                               QUERY PLAN                                                                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=16063029.48..16063031.73 rows=100 width=268)
   ->  Gather Motion 3:1  (slice6; segments: 3)  (cost=16063029.48..16063031.73 rows=100 width=268)
         Merge Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, web_site.web_name
         ->  Limit  (cost=16063029.48..16063029.73 rows=34 width=268)
               ->  Sort  (cost=16063029.48..16063032.18 rows=360 width=268)
                     Sort Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, web_site.web_name
                     ->  HashAggregate  (cost=16062977.40..16062988.20 rows=360 width=268)
                           Group Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, web_site.web_name
                           ->  Redistribute Motion 3:3  (slice5; segments: 3)  (cost=16062877.50..16062901.80 rows=360 width=268)
                                 Hash Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, web_site.web_name
                                 ->  HashAggregate  (cost=16062877.50..16062880.20 rows=360 width=268)
                                       Group Key: substr((warehouse.w_warehouse_name)::text, 1, 20), ship_mode.sm_type, web_site.web_name
                                       ->  Hash Join  (cost=1541.55..15852443.51 rows=1169078 width=40)
                                             Hash Cond: (web_sales_1_prt_outliers.ws_web_site_sk = web_site.web_site_sk)
                                             ->  Hash Join  (cost=1512.82..15786652.70 rows=1169156 width=37)
                                                   Hash Cond: (web_sales_1_prt_outliers.ws_warehouse_sk = warehouse.w_warehouse_sk)
                                                   ->  Hash Join  (cost=1496.07..15729637.41 rows=1169273 width=24)
                                                         Hash Cond: (web_sales_1_prt_outliers.ws_ship_mode_sk = ship_mode.sm_ship_mode_sk)
                                                         ->  Hash Join  (cost=1479.32..15672614.95 rows=1169469 width=20)
                                                               Hash Cond: (web_sales_1_prt_outliers.ws_ship_date_sk = date_dim.d_date_sk)
                                                               ->  Append  (cost=0.00..11136051.31 rows=240000015 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_outliers  (cost=0.00..2391.21 rows=59974 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_2  (cost=0.00..94902.80 rows=2044794 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_3  (cost=0.00..98794.40 rows=2129180 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_4  (cost=0.00..95176.20 rows=2051340 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_5  (cost=0.00..98886.20 rows=2130874 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_6  (cost=0.00..98686.80 rows=2126394 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_7  (cost=0.00..98900.30 rows=2131144 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_8  (cost=0.00..98568.30 rows=2124144 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_9  (cost=0.00..143675.40 rows=3096280 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_10  (cost=0.00..224454.00 rows=4837567 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_11  (cost=0.00..224538.00 rows=4838600 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_12  (cost=0.00..232917.00 rows=5019700 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_13  (cost=0.00..340347.00 rows=7335234 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_14  (cost=0.00..339963.00 rows=7326700 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_15  (cost=0.00..128058.80 rows=2759894 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_16  (cost=0.00..98762.90 rows=2127930 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_17  (cost=0.00..95130.30 rows=2049977 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_18  (cost=0.00..98536.30 rows=2123477 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_19  (cost=0.00..98763.80 rows=2128160 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_20  (cost=0.00..98632.00 rows=2125534 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_21  (cost=0.00..98600.90 rows=2124597 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_22  (cost=0.00..139196.60 rows=2999954 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_23  (cost=0.00..224702.00 rows=4842300 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_24  (cost=0.00..224404.00 rows=4836067 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_25  (cost=0.00..228579.00 rows=4926567 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_26  (cost=0.00..340407.00 rows=7336234 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_27  (cost=0.00..339824.00 rows=7323934 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_28  (cost=0.00..136669.10 rows=2945270 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_29  (cost=0.00..98265.40 rows=2117680 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_30  (cost=0.00..98510.80 rows=2122894 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_31  (cost=0.00..98626.80 rows=2125460 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_32  (cost=0.00..98594.80 rows=2124860 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_33  (cost=0.00..98426.60 rows=2121220 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_34  (cost=0.00..98533.60 rows=2123320 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_35  (cost=0.00..134141.00 rows=2890900 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_36  (cost=0.00..224203.00 rows=4832167 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_37  (cost=0.00..224486.00 rows=4838100 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_38  (cost=0.00..224574.00 rows=4840000 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_39  (cost=0.00..339843.00 rows=7323734 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_40  (cost=0.00..339993.00 rows=7327400 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_41  (cost=0.00..141767.90 rows=3054930 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_42  (cost=0.00..98461.00 rows=2121867 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_43  (cost=0.00..95277.50 rows=2053050 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_44  (cost=0.00..98854.40 rows=2130480 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_45  (cost=0.00..98738.70 rows=2127790 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_46  (cost=0.00..98685.60 rows=2126654 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_47  (cost=0.00..98998.50 rows=2133217 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_48  (cost=0.00..125716.80 rows=2709260 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_49  (cost=0.00..224729.00 rows=4843367 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_50  (cost=0.00..224641.00 rows=4841034 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_51  (cost=0.00..224630.00 rows=4841267 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_52  (cost=0.00..332139.00 rows=7158600 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_53  (cost=0.00..340420.00 rows=7336634 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_54  (cost=0.00..162712.00 rows=3506534 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_55  (cost=0.00..98867.20 rows=2130440 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_56  (cost=0.00..95121.00 rows=2049967 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_57  (cost=0.00..98600.60 rows=2124820 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_58  (cost=0.00..98639.10 rows=2125604 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_59  (cost=0.00..98591.40 rows=2124880 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_60  (cost=0.00..98868.30 rows=2130610 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_61  (cost=0.00..121113.60 rows=2609954 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_62  (cost=0.00..224388.00 rows=4835634 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_63  (cost=0.00..224495.00 rows=4837834 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_64  (cost=0.00..224520.00 rows=4838767 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_65  (cost=0.00..328357.00 rows=7076767 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_66  (cost=0.00..340970.00 rows=7348567 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_67  (cost=0.00..97070.40 rows=2091947 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_68  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_69  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_70  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_71  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_72  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_73  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_74  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_75  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_76  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_77  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_78  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_79  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on web_sales_1_prt_80  (cost=0.00..1.00 rows=1 width=20)
                                                               ->  Hash  (cost=1465.97..1465.97 rows=356 width=4)
                                                                     ->  Broadcast Motion 3:3  (slice1; segments: 3)  (cost=0.00..1465.97 rows=356 width=4)
                                                                           ->  Seq Scan on date_dim  (cost=0.00..1451.73 rows=119 width=4)
                                                                                 Filter: ((d_month_seq >= 1212) AND (d_month_seq <= 1223))
                                                         ->  Hash  (cost=16.00..16.00 rows=20 width=12)
                                                               ->  Broadcast Motion 3:3  (slice2; segments: 3)  (cost=0.00..16.00 rows=20 width=12)
                                                                     ->  Seq Scan on ship_mode  (cost=0.00..15.20 rows=7 width=12)
                                                   ->  Hash  (cost=16.00..16.00 rows=20 width=21)
                                                         ->  Broadcast Motion 3:3  (slice3; segments: 3)  (cost=0.00..16.00 rows=20 width=21)
                                                               ->  Seq Scan on warehouse  (cost=0.00..15.20 rows=7 width=21)
                                             ->  Hash  (cost=26.70..26.70 rows=54 width=11)
                                                   ->  Broadcast Motion 3:3  (slice4; segments: 3)  (cost=0.00..26.70 rows=54 width=11)
                                                         ->  Seq Scan on web_site  (cost=0.00..24.54 rows=18 width=11)
 Planning time: 16.080 ms
 Optimizer: legacy query optimizer
(116 rows)

-- end query 1 in stream 0 using template query62.tpl
