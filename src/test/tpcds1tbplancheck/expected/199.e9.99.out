-- start query 1 in stream 0 using template query99.tpl
explain
select  
   substr(w_warehouse_name,1,20)
  ,sm_type
  ,cc_name
  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk <= 30 ) then 1 else 0 end)  as "30 days" 
  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 30) and 
                 (cs_ship_date_sk - cs_sold_date_sk <= 60) then 1 else 0 end )  as "31-60 days" 
  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 60) and 
                 (cs_ship_date_sk - cs_sold_date_sk <= 90) then 1 else 0 end)  as "61-90 days" 
  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk > 90) and
                 (cs_ship_date_sk - cs_sold_date_sk <= 120) then 1 else 0 end)  as "91-120 days" 
  ,sum(case when (cs_ship_date_sk - cs_sold_date_sk  > 120) then 1 else 0 end)  as ">120 days" 
from
   catalog_sales
  ,warehouse
  ,ship_mode
  ,call_center
  ,date_dim
where
    d_month_seq between 1212 and 1212 + 11
and cs_ship_date_sk   = d_date_sk
and cs_warehouse_sk   = w_warehouse_sk
and cs_ship_mode_sk   = sm_ship_mode_sk
and cs_call_center_sk = cc_call_center_sk
group by
   substr(w_warehouse_name,1,20)
  ,sm_type
  ,cc_name
order by substr(w_warehouse_name,1,20)
        ,sm_type
        ,cc_name
limit 100;
                                                                                   QUERY PLAN                                                                                   
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=32330354.94..32330357.19 rows=100 width=268)
   ->  Gather Motion 3:1  (slice6; segments: 3)  (cost=32330354.94..32330357.19 rows=100 width=268)
         Merge Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, call_center.cc_name
         ->  Limit  (cost=32330354.94..32330355.19 rows=34 width=268)
               ->  Sort  (cost=32330354.94..32330361.24 rows=840 width=268)
                     Sort Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, call_center.cc_name
                     ->  HashAggregate  (cost=32330233.43..32330258.63 rows=840 width=268)
                           Group Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, call_center.cc_name
                           ->  Redistribute Motion 3:3  (slice5; segments: 3)  (cost=32330000.33..32330057.03 rows=840 width=268)
                                 Hash Key: (substr((warehouse.w_warehouse_name)::text, 1, 20)), ship_mode.sm_type, call_center.cc_name
                                 ->  HashAggregate  (cost=32330000.33..32330006.63 rows=840 width=268)
                                       Group Key: substr((warehouse.w_warehouse_name)::text, 1, 20), ship_mode.sm_type, call_center.cc_name
                                       ->  Hash Join  (cost=1537.50..31913651.41 rows=2313050 width=47)
                                             Hash Cond: (catalog_sales_1_prt_outliers.cs_ship_mode_sk = ship_mode.sm_ship_mode_sk)
                                             ->  Hash Join  (cost=1520.75..31783418.38 rows=2318770 width=43)
                                                   Hash Cond: (catalog_sales_1_prt_outliers.cs_warehouse_sk = warehouse.w_warehouse_sk)
                                                   ->  Hash Join  (cost=1504.00..31670239.56 rows=2325280 width=30)
                                                         Hash Cond: (catalog_sales_1_prt_outliers.cs_call_center_sk = call_center.cc_call_center_sk)
                                                         ->  Hash Join  (cost=1479.32..31556730.68 rows=2332043 width=20)
                                                               Hash Cond: (catalog_sales_1_prt_outliers.cs_ship_date_sk = date_dim.d_date_sk)
                                                               ->  Append  (cost=0.00..22485412.30 rows=479993481 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_outliers  (cost=0.00..95971.30 rows=2401110 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_2  (cost=0.00..198531.00 rows=4234734 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_3  (cost=0.00..198470.00 rows=4233434 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_4  (cost=0.00..191463.00 rows=4083934 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_5  (cost=0.00..198330.00 rows=4230434 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_6  (cost=0.00..198496.00 rows=4233967 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_7  (cost=0.00..198494.00 rows=4233967 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_8  (cost=0.00..198576.00 rows=4235667 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_9  (cost=0.00..297942.00 rows=6355400 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_10  (cost=0.00..451674.00 rows=9634834 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_11  (cost=0.00..451572.00 rows=9632700 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_12  (cost=0.00..476631.00 rows=10167234 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_13  (cost=0.00..684375.00 rows=14598867 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_14  (cost=0.00..684389.00 rows=14599200 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_15  (cost=0.00..215804.00 rows=4603234 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_16  (cost=0.00..198278.00 rows=4229400 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_17  (cost=0.00..191360.00 rows=4081734 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_18  (cost=0.00..198408.00 rows=4232134 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_19  (cost=0.00..198462.00 rows=4233300 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_20  (cost=0.00..198463.00 rows=4233267 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_21  (cost=0.00..198544.00 rows=4235034 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_22  (cost=0.00..288857.00 rows=6161600 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_23  (cost=0.00..451775.00 rows=9637067 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_24  (cost=0.00..451807.00 rows=9637734 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_25  (cost=0.00..468431.00 rows=9992300 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_26  (cost=0.00..684511.00 rows=14601800 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_27  (cost=0.00..684485.00 rows=14601267 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_28  (cost=0.00..232955.00 rows=4969100 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_29  (cost=0.00..198182.00 rows=4227400 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_30  (cost=0.00..198180.00 rows=4227300 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_31  (cost=0.00..198236.00 rows=4228467 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_32  (cost=0.00..198161.00 rows=4226867 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_33  (cost=0.00..198143.00 rows=4226467 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_34  (cost=0.00..198217.00 rows=4228000 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_35  (cost=0.00..279401.00 rows=5959900 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_36  (cost=0.00..451102.00 rows=9622600 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_37  (cost=0.00..451004.00 rows=9620567 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_38  (cost=0.00..459207.00 rows=9795567 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_39  (cost=0.00..683201.00 rows=14573867 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_40  (cost=0.00..683288.00 rows=14575634 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_41  (cost=0.00..267716.00 rows=5710600 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_42  (cost=0.00..198348.00 rows=4230867 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_43  (cost=0.00..191374.00 rows=4082034 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_44  (cost=0.00..198449.00 rows=4233067 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_45  (cost=0.00..198436.00 rows=4232667 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_46  (cost=0.00..198484.00 rows=4233767 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_47  (cost=0.00..198486.00 rows=4233767 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_48  (cost=0.00..261759.00 rows=5583500 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_49  (cost=0.00..451867.00 rows=9638934 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_50  (cost=0.00..451711.00 rows=9635634 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_51  (cost=0.00..451715.00 rows=9635700 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_52  (cost=0.00..676048.00 rows=14421300 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_53  (cost=0.00..684330.00 rows=14597934 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_54  (cost=0.00..285353.00 rows=6086800 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_55  (cost=0.00..198500.00 rows=4234067 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_56  (cost=0.00..191327.00 rows=4081100 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_57  (cost=0.00..198470.00 rows=4233434 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_58  (cost=0.00..198434.00 rows=4232667 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_59  (cost=0.00..198457.00 rows=4233100 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_60  (cost=0.00..198420.00 rows=4232400 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_61  (cost=0.00..252732.00 rows=5390967 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_62  (cost=0.00..451735.00 rows=9636134 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_63  (cost=0.00..451761.00 rows=9636700 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_64  (cost=0.00..451680.00 rows=9634900 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_65  (cost=0.00..667727.00 rows=14243734 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_66  (cost=0.00..684173.00 rows=14594534 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_67  (cost=0.00..244531.00 rows=5216100 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_68  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_69  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_70  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_71  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_72  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_73  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_74  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_75  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_76  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_77  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_78  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_79  (cost=0.00..1.00 rows=1 width=20)
                                                                     ->  Append-only Columnar Scan on catalog_sales_1_prt_80  (cost=0.00..1.00 rows=1 width=20)
                                                               ->  Hash  (cost=1465.97..1465.97 rows=356 width=4)
                                                                     ->  Broadcast Motion 3:3  (slice1; segments: 3)  (cost=0.00..1465.97 rows=356 width=4)
                                                                           ->  Seq Scan on date_dim  (cost=0.00..1451.73 rows=119 width=4)
                                                                                 Filter: ((d_month_seq >= 1212) AND (d_month_seq <= 1223))
                                                         ->  Hash  (cost=23.10..23.10 rows=42 width=18)
                                                               ->  Broadcast Motion 3:3  (slice2; segments: 3)  (cost=0.00..23.10 rows=42 width=18)
                                                                     ->  Seq Scan on call_center  (cost=0.00..21.42 rows=14 width=18)
                                                   ->  Hash  (cost=16.00..16.00 rows=20 width=21)
                                                         ->  Broadcast Motion 3:3  (slice3; segments: 3)  (cost=0.00..16.00 rows=20 width=21)
                                                               ->  Seq Scan on warehouse  (cost=0.00..15.20 rows=7 width=21)
                                             ->  Hash  (cost=16.00..16.00 rows=20 width=12)
                                                   ->  Broadcast Motion 3:3  (slice4; segments: 3)  (cost=0.00..16.00 rows=20 width=12)
                                                         ->  Seq Scan on ship_mode  (cost=0.00..15.20 rows=7 width=12)
 Planning time: 17.712 ms
 Optimizer: legacy query optimizer
(116 rows)

-- end query 1 in stream 0 using template query99.tpl
