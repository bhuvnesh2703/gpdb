-- start query 1 in stream 0 using template query18.tpl
explain
select  i_item_id,
        ca_country,
        ca_state, 
        ca_county,
        avg( cast(cs_quantity as numeric(12,2))) agg1,
        avg( cast(cs_list_price as numeric(12,2))) agg2,
        avg( cast(cs_coupon_amt as numeric(12,2))) agg3,
        avg( cast(cs_sales_price as numeric(12,2))) agg4,
        avg( cast(cs_net_profit as numeric(12,2))) agg5,
        avg( cast(c_birth_year as numeric(12,2))) agg6,
        avg( cast(cd1.cd_dep_count as numeric(12,2))) agg7
 from catalog_sales, customer_demographics cd1, 
      customer_demographics cd2, customer, customer_address, date_dim, item
 where cs_sold_date_sk = d_date_sk and
       cs_item_sk = i_item_sk and
       cs_bill_cdemo_sk = cd1.cd_demo_sk and
       cs_bill_customer_sk = c_customer_sk and
       cd1.cd_gender = 'M' and 
       cd1.cd_education_status = 'College' and
       c_current_cdemo_sk = cd2.cd_demo_sk and
       c_current_addr_sk = ca_address_sk and
       c_birth_month in (9,5,12,4,1,10) and
       d_year = 2001 and
       ca_state in ('ND','WI','AL'
                   ,'NC','OK','MS','TN')
 group by rollup (i_item_id, ca_country, ca_state, ca_county)
 order by ca_country,
        ca_state, 
        ca_county,
	i_item_id
 limit 100;
                                                                                            QUERY PLAN                                                                                            
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=0.00..295581.96 rows=34 width=104)
   ->  Gather Motion 3:1  (slice13; segments: 3)  (cost=0.00..295581.95 rows=100 width=104)
         Merge Key: share0_ref2.ca_country, share0_ref2.ca_state, share0_ref2.ca_county, share0_ref2.i_item_id
         ->  Limit  (cost=0.00..295581.91 rows=34 width=104)
               ->  Sort  (cost=0.00..295581.91 rows=6669685 width=104)
                     Sort Key: share0_ref2.ca_country, share0_ref2.ca_state, share0_ref2.ca_county, share0_ref2.i_item_id
                     ->  Sequence  (cost=0.00..206424.45 rows=6669685 width=104)
                           ->  Shared Scan (share slice:id 13:0)  (cost=0.00..182112.56 rows=208088 width=1)
                                 ->  Materialize  (cost=0.00..182112.56 rows=208088 width=1)
                                       ->  Hash Join  (cost=0.00..182112.36 rows=208088 width=77)
                                             Hash Cond: (catalog_sales.cs_item_sk = item.i_item_sk)
                                             ->  Redistribute Motion 3:3  (slice12; segments: 3)  (cost=0.00..181502.90 rows=208088 width=64)
                                                   Hash Key: catalog_sales.cs_item_sk
                                                   ->  Hash Join  (cost=0.00..181461.22 rows=208088 width=64)
                                                         Hash Cond: (catalog_sales.cs_sold_date_sk = date_dim.d_date_sk)
                                                         ->  Hash Join  (cost=0.00..180756.00 rows=1044300 width=68)
                                                               Hash Cond: (catalog_sales.cs_bill_cdemo_sk = customer_demographics_1.cd_demo_sk)
                                                               ->  Hash Join  (cost=0.00..178224.98 rows=7795625 width=68)
                                                                     Hash Cond: (catalog_sales.cs_bill_customer_sk = customer.c_customer_sk)
                                                                     ->  Dynamic Table Scan on catalog_sales (dynamic scan id: 1)  (cost=0.00..46102.37 rows=479993344 width=37)
                                                                     ->  Hash  (cost=2831.81..2831.81 rows=166215 width=39)
                                                                           ->  Broadcast Motion 3:3  (slice9; segments: 3)  (cost=0.00..2831.81 rows=166215 width=39)
                                                                                 ->  Hash Join  (cost=0.00..2715.77 rows=55405 width=39)
                                                                                       Hash Cond: (customer.c_current_cdemo_sk = customer_demographics.cd_demo_sk)
                                                                                       ->  Redistribute Motion 3:3  (slice8; segments: 3)  (cost=0.00..2114.20 rows=55405 width=43)
                                                                                             Hash Key: customer.c_current_cdemo_sk
                                                                                             ->  Hash Join  (cost=0.00..2106.75 rows=55405 width=43)
                                                                                                   Hash Cond: (customer.c_current_addr_sk = customer_address.ca_address_sk)
                                                                                                   ->  Redistribute Motion 3:3  (slice7; segments: 3)  (cost=0.00..1056.25 rows=1950681 width=16)
                                                                                                         Hash Key: customer.c_current_addr_sk
                                                                                                         ->  Table Scan on customer  (cost=0.00..958.56 rows=1950681 width=16)
                                                                                                               Filter: (c_birth_month = ANY ('{9,5,12,4,1,10}'::integer[]))
                                                                                                   ->  Hash  (cost=650.04..650.04 rows=38104 width=35)
                                                                                                         ->  Table Scan on customer_address  (cost=0.00..650.04 rows=38104 width=35)
                                                                                                               Filter: ((ca_state)::text = ANY ('{ND,WI,AL,NC,OK,MS,TN}'::text[]))
                                                                                       ->  Hash  (cost=456.00..456.00 rows=640260 width=4)
                                                                                             ->  Table Scan on customer_demographics  (cost=0.00..456.00 rows=640260 width=4)
                                                               ->  Hash  (cost=536.08..536.08 rows=243909 width=8)
                                                                     ->  Broadcast Motion 3:3  (slice10; segments: 3)  (cost=0.00..536.08 rows=243909 width=8)
                                                                           ->  Table Scan on customer_demographics customer_demographics_1  (cost=0.00..501.16 rows=81303 width=8)
                                                                                 Filter: ((cd_gender = 'M'::bpchar) AND ((cd_education_status)::text = 'College'::text))
                                                         ->  Hash  (cost=100.00..100.00 rows=34 width=4)
                                                               ->  Partition Selector for catalog_sales (dynamic scan id: 1)  (cost=10.00..100.00 rows=34 width=4)
                                                                     ->  Broadcast Motion 3:3  (slice11; segments: 3)  (cost=0.00..433.78 rows=366 width=4)
                                                                           ->  Table Scan on date_dim  (cost=0.00..433.76 rows=122 width=4)
                                                                                 Filter: (d_year = 2001)
                                             ->  Hash  (cost=447.68..447.68 rows=99749 width=21)
                                                   ->  Table Scan on item  (cost=0.00..447.68 rows=99749 width=21)
                           ->  Append  (cost=0.00..23618.24 rows=6669685 width=104)
                                 ->  HashAggregate  (cost=0.00..11409.57 rows=6531122 width=104)
                                       Group Key: share0_ref2.ca_country, share0_ref2.ca_state, share0_ref2.ca_county, share0_ref2.i_item_id
                                       ->  Redistribute Motion 3:3  (slice1; segments: 3)  (cost=0.00..7589.28 rows=6531122 width=104)
                                             Hash Key: share0_ref2.ca_country, share0_ref2.ca_state, share0_ref2.ca_county, share0_ref2.i_item_id
                                             ->  Result  (cost=0.00..5463.27 rows=6531122 width=104)
                                                   ->  HashAggregate  (cost=0.00..5463.27 rows=6531122 width=104)
                                                         Group Key: share0_ref2.ca_country, share0_ref2.ca_state, share0_ref2.ca_county, share0_ref2.i_item_id
                                                         ->  Shared Scan (share slice:id 1:0)  (cost=0.00..1642.98 rows=6531122 width=77)
                                 ->  Result  (cost=0.00..4176.77 rows=47964 width=98)
                                       ->  HashAggregate  (cost=0.00..4172.06 rows=47964 width=90)
                                             Group Key: share0_ref3.ca_country, share0_ref3.ca_state, share0_ref3.i_item_id
                                             ->  Redistribute Motion 3:3  (slice2; segments: 3)  (cost=0.00..4150.93 rows=47964 width=90)
                                                   Hash Key: share0_ref3.ca_country, share0_ref3.ca_state, share0_ref3.i_item_id
                                                   ->  Result  (cost=0.00..4137.41 rows=47964 width=90)
                                                         ->  HashAggregate  (cost=0.00..4137.41 rows=47964 width=90)
                                                               Group Key: share0_ref3.ca_country, share0_ref3.ca_state, share0_ref3.i_item_id
                                                               ->  Shared Scan (share slice:id 2:0)  (cost=0.00..1422.62 rows=6531122 width=63)
                                 ->  Result  (cost=0.00..3263.49 rows=47964 width=103)
                                       ->  HashAggregate  (cost=0.00..3258.55 rows=47964 width=87)
                                             Group Key: share0_ref4.ca_country, share0_ref4.i_item_id
                                             ->  Redistribute Motion 3:3  (slice3; segments: 3)  (cost=0.00..3243.76 rows=47964 width=87)
                                                   Hash Key: share0_ref4.ca_country, share0_ref4.i_item_id
                                                   ->  Result  (cost=0.00..3230.70 rows=47964 width=87)
                                                         ->  HashAggregate  (cost=0.00..3230.70 rows=47964 width=87)
                                                               Group Key: share0_ref4.ca_country, share0_ref4.i_item_id
                                                               ->  Shared Scan (share slice:id 3:0)  (cost=0.00..1375.40 rows=6531122 width=60)
                                 ->  Result  (cost=0.00..2147.87 rows=42635 width=97)
                                       ->  HashAggregate  (cost=0.00..2143.73 rows=42635 width=73)
                                             Group Key: share0_ref5.i_item_id
                                             ->  Redistribute Motion 3:3  (slice4; segments: 3)  (cost=0.00..2136.52 rows=42635 width=73)
                                                   Hash Key: share0_ref5.i_item_id
                                                   ->  Result  (cost=0.00..2126.78 rows=42635 width=73)
                                                         ->  HashAggregate  (cost=0.00..2126.78 rows=42635 width=73)
                                                               Group Key: share0_ref5.i_item_id
                                                               ->  Shared Scan (share slice:id 4:0)  (cost=0.00..1155.04 rows=6531122 width=46)
                                 ->  Result  (cost=0.00..1926.90 rows=1 width=88)
                                       ->  Redistribute Motion 1:3  (slice6)  (cost=0.00..1926.90 rows=1 width=56)
                                             ->  Aggregate  (cost=0.00..1926.90 rows=1 width=56)
                                                   ->  Gather Motion 3:1  (slice5; segments: 3)  (cost=0.00..1926.90 rows=1 width=56)
                                                         ->  Aggregate  (cost=0.00..1926.90 rows=1 width=56)
                                                               ->  Shared Scan (share slice:id 5:0)  (cost=0.00..887.46 rows=6531122 width=29)
 Planning time: 1290.497 ms
 Optimizer: PQO version 3.8.0
(92 rows)

-- end query 1 in stream 0 using template query18.tpl
